<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TeraWatt Challenge</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #1A1A2E;
    color: #E0E0E0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    text-align: center;
    padding: 24px;
  }
  .card {
    background: #252540;
    border-radius: 16px;
    padding: 40px 32px;
    max-width: 400px;
    width: 100%;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  }
  .bolt { font-size: 48px; margin-bottom: 16px; }
  h1 { color: #00D4FF; font-size: 24px; margin-bottom: 8px; }
  .subtitle { color: #999; font-size: 14px; margin-bottom: 24px; }
  .open-btn {
    display: inline-block;
    background: #7B2FBE;
    color: white;
    padding: 14px 32px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
    margin-bottom: 16px;
    transition: background 0.2s;
  }
  .open-btn:hover { background: #9B4FDE; }
  .store-link {
    display: block;
    color: #00D4FF;
    font-size: 13px;
    text-decoration: none;
    margin-top: 12px;
  }
  .store-link:hover { text-decoration: underline; }
  .status { color: #FFB800; font-size: 13px; margin-top: 16px; min-height: 20px; }
</style>
</head>
<body>
<div class="card">
  <div class="bolt">⚡</div>
  <h1>TeraWatt Challenge</h1>
  <p class="subtitle">Someone challenged you to solve their puzzle!</p>

  <a id="openBtn" class="open-btn" href="#">Open in TeraWatt</a>

  <p class="status" id="status"></p>

  <a class="store-link" href="https://play.google.com/store/apps/details?id=com.terawatt">
    Don't have TeraWatt? Get it on Google Play
  </a>
</div>

<script>
  // Parse challenge parameters from URL
  const params = new URLSearchParams(window.location.search);
  const seed = params.get('s');
  const diff = params.get('d');

  if (seed && diff !== null) {
    const deepLink = 'terawatt://challenge?s=' + seed + '&d=' + diff;

    // Intent URI for Chrome on Android — opens app or falls back to Play Store
    const intentUri = 'intent://challenge?s=' + seed + '&d=' + diff
      + '#Intent;scheme=terawatt;package=com.terawatt;end';

    const openBtn = document.getElementById('openBtn');
    const status = document.getElementById('status');

    // Detect if Android
    const isAndroid = /android/i.test(navigator.userAgent);

    if (isAndroid) {
      // Use intent URI for best Android compatibility
      openBtn.href = intentUri;

      // Also try auto-opening via deep link
      const start = Date.now();
      window.location = deepLink;

      // If we're still here after 1.5s, the app probably isn't installed
      setTimeout(function() {
        if (Date.now() - start < 2000) return;
        status.textContent = 'Tap the button above to open TeraWatt';
      }, 1500);
    } else {
      openBtn.href = deepLink;
      status.textContent = 'TeraWatt is available on Android';
    }
  } else {
    document.getElementById('status').textContent = 'Invalid challenge link';
    document.getElementById('openBtn').style.display = 'none';
  }
</script>
</body>
</html>
